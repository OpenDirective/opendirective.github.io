<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<title>Working with Windows native code from node.js | Opening Accessibility</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="/wp-content/themes/accessible/style.css" />
<link rel="pingback" href="/xmlrpc.php" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Opening Accessibility &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Opening Accessibility &raquo; Comments Feed" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Opening Accessibility &raquo; Working with Windows native code from node.js Comments Feed" href="/2015/10/working-with-windows-native-code-from-node-js/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/opendirective.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/opendirective.net\/blog\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Progressive Enhancement &#8211; the web&#8217;s strength' href='/2015/06/progressive-enhancement/' />
<link rel='next' title='Dealing with Windows text line endings in git' href='/2015/12/dealing-with-windows-text-line-endings-in-git/' />
<meta name="generator" content="WordPress 4.9.8" />
<link rel="canonical" href="/2015/10/working-with-windows-native-code-from-node-js/" />
<link rel='shortlink' href='/?p=581' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fopendirective.net%2Fblog%2F2015%2F10%2Fworking-with-windows-native-code-from-node-js%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fopendirective.net%2Fblog%2F2015%2F10%2Fworking-with-windows-native-code-from-node-js%2F&#038;format=xml" />

<!-- Bad Behavior 2.2.22 run time: 3.804 ms -->
</head>

<body class="post-template-default single single-post postid-581 single-format-standard">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div id="branding" role="banner">
								<div id="site-title">
					<span>
						<a href="/" title="Opening Accessibility" rel="home">Opening Accessibility</a>
					</span>
				</div>
				<div id="site-description">Where open source joins accessibility</div>

										<img src="/wp-content/uploads/2013/02/copy-cropped-Lapland-gateway.jpg" width="940" height="198" alt="" />
								</div><!-- #branding -->

			<div id="access" role="navigation">
			  				<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
								<div class="menu"><ul>
<li ><a href="/">Home</a></li><li class="page_item page-item-8"><a href="/about/">About</a></li>
</ul></div>
			</div><!-- #access -->
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="/2015/06/progressive-enhancement/" rel="prev"><span class="meta-nav">&larr;</span> Progressive Enhancement &#8211; the web&#8217;s strength</a></div>
					<div class="nav-next"><a href="/2015/12/dealing-with-windows-text-line-endings-in-git/" rel="next">Dealing with Windows text line endings in git <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-581" class="post-581 post type-post status-publish format-standard hentry category-development tag-nodejs tag-web">
					<h1 class="entry-title">Working with Windows native code from node.js</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted on</span> <a href="/2015/10/working-with-windows-native-code-from-node-js/" title="9:48 pm" rel="bookmark"><span class="entry-date">October 19, 2015</span></a> <span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="/author/steveopendirective-com/" title="View all posts by Steve">Steve</a></span>					</div><!-- .entry-meta -->

					<div class="entry-content">
						<p>[UPDATE 02 Feb 2016: While this post discusses Win32 access, here&#8217;s an interesting option for <a href="http://jxcore.com/universal-windows-platform-uwp-samples-using-jxcore/">UWP access from JXCore</a> that should eventually work with nodejs when the Microsoft PR for Chakra is merged.]</p>
<p>While the <a href="https://nodejs.org/en/">node.js</a> ecosystem provides an amazing number of modules covering almost every imaginable use, sometimes you want to work with existing code created in other languages and tool chains. For example, you may have an existing C++ library or perhaps you want to call operating systems APIs not yet available in <a href="https://www.npmjs.com/">npm</a> or elsewhere.</p>
<p>When integrating between different language infrastructures you have a choice of which side of the divide to write the required glue code. Glue that provides data <a href="https://en.wikipedia.org/wiki/Marshalling_%28computer_science%29">marshalling</a>, function calling and event processing. If you want to access code with a C style calling convention then it relatively easy to add code on the C side as node is itself created in C++. This is easily enough done by  creating <a href="https://nodejs.org/api/addons.html">C/C++ addons</a> but often involves reams of boilerplate code. However, if you do choose that option then you&#8217;re going to want to use a tool like <a href="https://github.com/nodejs/nan">nan</a> to make your life tolerable. As the nan readme explains:</p>
<blockquote><p>Thanks to the crazy changes in V8 (and some in Node core), keeping native addons compiling happily across versions, particularly 0.10 to 0.12 to 4.0, is a minor nightmare. The goal of this project is to store all logic necessary to develop native Node.js add-ons without having to inspect <code>NODE_MODULE_VERSION</code> and get yourself into a macro-tangle.</p></blockquote>
<p>If you want to work on the Javascript side of the divide then <a href="https://github.com/TooTallNate/ref">ref</a> by <a href="https://twitter.com/TooTallNate">@TooTallNate</a> provides all the facilities you need for marshalling to/from the C world. It does this by extending node&#8217;s <a href="https://nodejs.org/api/buffer.html">Buffer class</a> to provide a type system and facilities for:</p>
<blockquote>
<ul>
<li>Getting the memory address of a Buffer</li>
<li>Checking the endianness of the processor</li>
<li>Checking if a Buffer represents the NULL pointer</li>
<li>Reading and writing &#8220;pointers&#8221; with Buffers</li>
<li>Reading and writing C Strings (NULL-terminated)</li>
<li>Reading and writing JavaScript Object references</li>
<li>Reading and writing <strong>int64_t</strong> and <strong>uint64_t</strong> values</li>
<li>A &#8220;type&#8221; convention to define the contents of a Buffer</li>
</ul>
</blockquote>
<p>Further related  <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=user%3ATooTallNate+ref&amp;type=Repositories&amp;ref=searchresults">ref modules</a> support javascript representations of other C/C++ types including arrays, structures and unions.</p>
<p>Building on ref&#8217;s facilities is <a href="https://github.com/node-ffi/node-ffi">node-fii</a> which provides a foreign function interface (ffi) for loading and calling functions exported by dynamic libraries (dlls on Windows). It is also possible to call functions in the current process, ideal for functions in static libraries.</p>
<p>While this eliminates large amounts of C boilerplate, it does have a significant calling overhead. Accordingly you are unlikely to want to use it for functions called in a tight loop or otherwise time sensitive applications.</p>
<p>Here&#8217;s a simple example from the lib-ffi documentation for wrapping <a href="https://sourceware.org/newlib/libm.html#floor">libm&#8217;s ceil()</a> function which takes a double parameter and returns a double result and also the static <a href="http://www.cplusplus.com/reference/cstdlib/atoi/">atoi()</a> which takes a string and returns an int.</p>
<div class="highlight highlight-source-js">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5b9f889fdc263970870773" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var ffi = require('ffi');

var libm = ffi.Library('libm', {
  'ceil': [ 'double', [ 'double' ] ]
});
libm.ceil(1.5); // 2

// You can also access just functions in the current process by passing a null
var current = ffi.Library(null, {
  'atoi': [ 'int', [ 'string' ] ]
});
current.atoi('1234'); // 1234</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-2">2</div><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-4">4</div><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-6">6</div><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-8">8</div><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-10">10</div><div class="crayon-num" data-line="crayon-5b9f889fdc263970870773-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc263970870773-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9f889fdc263970870773-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ffi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">'ffi'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-2">&nbsp;</div><div class="crayon-line" id="crayon-5b9f889fdc263970870773-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">libm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ffi</span><span class="crayon-sy">.</span><span class="crayon-e">Library</span><span class="crayon-sy">(</span><span class="crayon-s">'libm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">'ceil'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'double'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'double'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9f889fdc263970870773-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-6"><span class="crayon-v">libm</span><span class="crayon-sy">.</span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-cn">1.5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 2</span></div><div class="crayon-line" id="crayon-5b9f889fdc263970870773-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-8"><span class="crayon-c">// You can also access just functions in the current process by passing a null</span></div><div class="crayon-line" id="crayon-5b9f889fdc263970870773-9"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">current</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ffi</span><span class="crayon-sy">.</span><span class="crayon-e">Library</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">'atoi'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'int'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'string'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9f889fdc263970870773-11"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc263970870773-12"><span class="crayon-v">current</span><span class="crayon-sy">.</span><span class="crayon-e">atoi</span><span class="crayon-sy">(</span><span class="crayon-s">'1234'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 1234</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0032 seconds] -->

</div>
<p>A more complex example can be seen is some code I wrote for the <a href="http://gpii.net/">GPII</a> system for automatic personalisation from preferences. This is perhaps a slightly unusual application of Node.js as it runs on a Windows device in order to launch and configure various Windows&#8217; settings and assistive technology programmes.</p>
<p>The actual code provides a function GetDisplayResolution() that calls the Windows API <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd162611(v=vs.85).aspx">EnumDisplaySettings()</a> which returns into the fairly complex <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd183565(v=vs.85).aspx">DEVICEMODE</a> structure. Note that the DEVMODE structure includes nested unions of structures and while the ref modules support these I decided to  flattened out the declaration (after testing my assumptions about packing and padding).</p>
<div class="highlight highlight-source-js">
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5b9f889fdc274407902770" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var ffi = require("ffi");
var ref = require("ref");
var Struct = require("ref-struct");
var arrayType = require("ref-array");

/**
* A map between Windows and C types.
* https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751%28v=vs.85%29.aspx
*/
windows.types = {
    "BOOL":   "int",
    "INT":    "int",
    "UINT":   "uint",
    "ULONG":  "ulong",
    "DWORD":  "ulong",
    "HKL":    "void*",
    "ULONG_PTR": "ulong",
    "LONG":   "long",
    "HANDLE": "uint32",
    "WORD":   "uint16",
    "TCHAR":  "uint16"  // assuming unicode. (ASCII is char, UNICODE is WCHAR -&amp;gt; wchar_t -&amp;gt; unsigned short === UINT16 === uint16
};

var t = windows.types;
// https://msdn.microsoft.com/en-us/library/windows/desktop/dd183565(v=vs.85).aspx

var CCHDEVICENAME = 32;
var CCHFORMNAME = 32;

windows.DEVMODEW = new Struct([
    [arrayType(t.TCHAR, CCHDEVICENAME), "dmDeviceName"],
    [t.WORD, "dmSpecVersion"],
    [t.WORD, "dmDriverVersion"],
    [t.WORD, "dmSize"],
    [t.WORD, "dmDriverExtra"],
    [t.DWORD, "dmFields"],
    //union {   // TODO there is a ref-union npm module - but this technique is OK for now
    //  struct {
    ["short", "dmOrientation"],
    ["short", "dmPaperSize"],
    ["short", "dmPaperLength"],
    ["short", "dmPaperWidth"],
    ["short", "dmScale"],
    ["short", "dmCopies"],
    ["short", "dmDefaultSource"],
    ["short", "dmPrintQuality"],
    //  };
    //  struct {
    //      POINTL dmPosition;
    //      DWORD dmDisplayOrientation;
    //      DWORD dmDisplayFixedOutput;
    //  };
    //};
    ["short", "dmColor"],
    ["short", "dmDuplex"],
    ["short", "dmYResolution"],
    ["short", "dmTTOption"],
    ["short", "dmCollate"],
    [arrayType(t.TCHAR, CCHFORMNAME), "dmFormName"],
    [t.WORD, "dmLogPixels"],
    [t.DWORD, "dmBitsPerPel"],
    [t.DWORD, "dmPelsWidth"],
    [t.DWORD, "dmPelsHeight"],
    //union {
        [t.DWORD,"dmDisplayFlags"],
    //  DWORD dmNup;
    //};
    [t.DWORD, "dmDisplayFrequency"],
    //#if (WINVER &amp;gt;= 0x0400)
    [t.DWORD, "dmICMMethod"],
    [t.DWORD, "dmICMIntent"],
    [t.DWORD, "dmMediaType"],
    [t.DWORD, "dmDitherType"],
    [t.DWORD, "dmReserved1"],
    [t.DWORD, "dmReserved2"],
    //#if (WINVER &amp;gt;= 0x0500) || (_WIN32_WINNT &amp;gt;= 0x0400)
    [t.DWORD, "dmPanningWidth"],
    [t.DWORD, "dmPanningHeight"]
    //#endif
    //#endif
]);

windows.user32 = ffi.Library("user32", {
    // https://msdn.microsoft.com/en-us/library/windows/desktop/dd162611(v=vs.85).aspx
    // LPCWSTR, DWORD, DEVMODE*
    "EnumDisplaySettingsW": [
        t.BOOL, ["pointer", t.DWORD, "pointer"]
    ]
});

/**
 *  Gets the current screen resolution
 *
 * @return {Object) The width and height of the screen.
 */
windows.getScreenResolution = function () {
    var dm = new windows.DEVMODEW();
    dm.ref().fill(0);
    dm.dmSize = windows.DEVMODEW.size;

    if (c.FALSE != windows.user32.EnumDisplaySettingsW(ref.NULL, c.ENUM_CURRENT_SETTINGS, dm.ref()))
    {
        // note for unknown reason on win 10 the returned dmSize is 188 not expected 220
        return { width: dm.dmPelsWidth, height: dm.dmPelsHeight };
    }
    return { width: 0, height: 0 };

}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-2">2</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-4">4</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-6">6</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-8">8</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-10">10</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-12">12</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-14">14</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-16">16</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-18">18</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-20">20</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-22">22</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-24">24</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-26">26</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-28">28</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-30">30</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-32">32</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-34">34</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-36">36</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-38">38</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-40">40</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-42">42</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-44">44</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-46">46</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-48">48</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-50">50</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-52">52</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-54">54</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-56">56</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-58">58</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-60">60</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-62">62</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-64">64</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-66">66</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-68">68</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-70">70</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-72">72</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-74">74</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-76">76</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-78">78</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-80">80</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-82">82</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-84">84</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-86">86</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-88">88</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-90">90</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-92">92</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-94">94</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-96">96</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-98">98</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-100">100</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-102">102</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-104">104</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-106">106</div><div class="crayon-num" data-line="crayon-5b9f889fdc274407902770-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5b9f889fdc274407902770-108">108</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9f889fdc274407902770-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ffi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">"ffi"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ref</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">"ref"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-3"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-t">Struct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">"ref-struct"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-4"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">arrayType</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span class="crayon-s">"ref-array"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-6"><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-7"><span class="crayon-c">* A map between Windows and C types.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-8"><span class="crayon-c">* https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751%28v=vs.85%29.aspx</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-9"><span class="crayon-c">*/</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-10"><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">types</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"BOOL"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-s">"int"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"INT"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"int"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"UINT"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-s">"uint"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"ULONG"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"ulong"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"DWORD"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"ulong"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"HKL"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"void*"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"ULONG_PTR"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"ulong"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"LONG"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-s">"long"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"HANDLE"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"uint32"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"WORD"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-s">"uint16"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"TCHAR"</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-s">"uint16"</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// assuming unicode. (ASCII is char, UNICODE is WCHAR -&amp;gt; wchar_t -&amp;gt; unsigned short === UINT16 === uint16</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-22"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-24"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">types</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-25"><span class="crayon-c">// https://msdn.microsoft.com/en-us/library/windows/desktop/dd183565(v=vs.85).aspx</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-26">&nbsp;</div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-27"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">CCHDEVICENAME</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-28"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">CCHFORMNAME</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-30"><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">DEVMODEW</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">Struct</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">arrayType</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">TCHAR</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CCHDEVICENAME</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDeviceName"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">WORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmSpecVersion"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">WORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDriverVersion"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">WORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmSize"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">WORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDriverExtra"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmFields"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//union {&nbsp;&nbsp; // TODO there is a ref-union npm module - but this technique is OK for now</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;struct {</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmOrientation"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPaperSize"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPaperLength"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPaperWidth"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmScale"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmCopies"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDefaultSource"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPrintQuality"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;};</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;struct {</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POINTL dmPosition;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD dmDisplayOrientation;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD dmDisplayFixedOutput;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;};</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//};</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmColor"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDuplex"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmYResolution"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmTTOption"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">"short"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmCollate"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">arrayType</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">TCHAR</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CCHFORMNAME</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmFormName"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">WORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmLogPixels"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmBitsPerPel"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPelsWidth"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPelsHeight"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//union {</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-s">"dmDisplayFlags"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//&nbsp;&nbsp;DWORD dmNup;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//};</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDisplayFrequency"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//#if (WINVER &amp;gt;= 0x0400)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmICMMethod"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmICMIntent"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmMediaType"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmDitherType"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmReserved1"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmReserved2"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//#if (WINVER &amp;gt;= 0x0500) || (_WIN32_WINNT &amp;gt;= 0x0400)</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPanningWidth"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"dmPanningHeight"</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//#endif</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//#endif</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-81"><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-82">&nbsp;</div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-83"><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">user32</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ffi</span><span class="crayon-sy">.</span><span class="crayon-e">Library</span><span class="crayon-sy">(</span><span class="crayon-s">"user32"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// https://msdn.microsoft.com/en-us/library/windows/desktop/dd162611(v=vs.85).aspx</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// LPCWSTR, DWORD, DEVMODE*</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"EnumDisplaySettingsW"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-t">BOOL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"pointer"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">DWORD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"pointer"</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-89"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-90">&nbsp;</div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-91"><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-92"><span class="crayon-c"> *&nbsp;&nbsp;Gets the current screen resolution</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-93"><span class="crayon-c"> *</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-94"><span class="crayon-c"> * @return {Object) The width and height of the screen.</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-95"><span class="crayon-c"> */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-96"><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">getScreenResolution</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">dm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-e">DEVMODEW</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">ref</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">fill</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-v">dmSize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">DEVMODEW</span><span class="crayon-sy">.</span><span class="crayon-v">size</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-100">&nbsp;</div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">.</span><span class="crayon-t">FALSE</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">windows</span><span class="crayon-sy">.</span><span class="crayon-v">user32</span><span class="crayon-sy">.</span><span class="crayon-e">EnumDisplaySettingsW</span><span class="crayon-sy">(</span><span class="crayon-v">ref</span><span class="crayon-sy">.</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">.</span><span class="crayon-v">ENUM_CURRENT_SETTINGS</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-e">ref</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// note for unknown reason on win 10 the returned dmSize is 188 not expected 220</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-v">dmPelsWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">dm</span><span class="crayon-sy">.</span><span class="crayon-i">dmPelsHeight</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5b9f889fdc274407902770-107">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5b9f889fdc274407902770-108"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0199 seconds] -->

</div>
											</div><!-- .entry-content -->


					<div class="entry-utility">
						This entry was posted in <a href="/category/development/" rel="category tag">development</a> and tagged <a href="/tag/nodejs/" rel="tag">nodejs</a>, <a href="/tag/web/" rel="tag">web</a>. Bookmark the <a href="/2015/10/working-with-windows-native-code-from-node-js/" title="Permalink to Working with Windows native code from node.js" rel="bookmark">permalink</a>.											</div><!-- .entry-utility -->
				</div><!-- #post-## -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="/2015/06/progressive-enhancement/" rel="prev"><span class="meta-nav">&larr;</span> Progressive Enhancement &#8211; the web&#8217;s strength</a></div>
					<div class="nav-next"><a href="/2015/12/dealing-with-windows-text-line-endings-in-git/" rel="next">Dealing with Windows text line endings in git <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				<a href="#wrapper" class="skip-content screen-reader-text">Skip to top</a><h2 class="screen-reader-text">Comments</h2>
			<div id="comments">


			<h3 id="comments-title">4 Responses to <em>Working with Windows native code from node.js</em></h3>


			<ol class="commentlist">
					<li class="comment even thread-even depth-1" id="li-comment-36306">
		<div id="comment-36306">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/9cf3b2625e7daf7aa5d01542fbedb2c5?s=40&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9cf3b2625e7daf7aa5d01542fbedb2c5?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">steve</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
			
			<div class="comment-meta commentmetadata"><a href="/2015/10/working-with-windows-native-code-from-node-js/#comment-36306">
				January 1, 2016 at 8:20 pm</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>more details on Scot Frees&#8217; blog <a href="http://blog.scottfrees.com/getting-your-c-to-the-web-with-node-js" rel="nofollow">http://blog.scottfrees.com/getting-your-c-to-the-web-with-node-js</a></p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='/2015/10/working-with-windows-native-code-from-node-js/?replytocom=36306#respond' onclick='return addComment.moveForm( "comment-36306", "36306", "respond", "581" )' aria-label='Reply to steve'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-40077">
		<div id="comment-40077">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/7983011d733db344fc07f5e98e49f37f?s=40&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7983011d733db344fc07f5e98e49f37f?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">prabhat singh</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
			
			<div class="comment-meta commentmetadata"><a href="/2015/10/working-with-windows-native-code-from-node-js/#comment-40077">
				November 22, 2016 at 4:22 am</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>Hi,</p>
<p>Nice article. I wanted to try getting current caret position, so came to your blog. I tried the following, but it doen&#8217;t work.</p>
<p>var ffi = require(&#8216;ffi&#8217;);<br />
var ref = require(&#8216;ref&#8217;);</p>
<p> var voidPtr = ref.refType(ref.types.void);<br />
  var user32 = ffi.Library(&#8216;user32.dll&#8217;, {<br />
      GetCaretPos:[&#8216;bool&#8217;,[voidPtr]]<br />
  });<br />
var pbuf = new Buffer(2);<br />
  caretpos = user32.GetCaretPos(pbuf);<br />
 var cpos =(new Uint8Array(pbuf));<br />
  console.log(&#8220;&gt;&#8221;,cpos  ); //Doesn&#8217;t work **&gt; Uint8Array [ 0, 0, 0, 0 ]**</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='/2015/10/working-with-windows-native-code-from-node-js/?replytocom=40077#respond' onclick='return addComment.moveForm( "comment-40077", "40077", "respond", "581" )' aria-label='Reply to prabhat singh'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-41261">
		<div id="comment-41261">
			<div class="comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/550bc29fb8b9490a592c884858ff6b27?s=40&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/550bc29fb8b9490a592c884858ff6b27?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Fabrício Lélis</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
			
			<div class="comment-meta commentmetadata"><a href="/2015/10/working-with-windows-native-code-from-node-js/#comment-41261">
				June 20, 2017 at 9:07 pm</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>Hi,<br />
Great article. I tried your example to GetDisplayResolution but, this error occurred:<br />
if (c.FALSE !== windows.EnumDisplaySettingsW(ref.NULL, c.ENUM_CURRENT_SETTINGS, dm.ref()))<br />
        ^</p>
<p>ReferenceError: c is not defined<br />
    at Object.windows.getScreenResolution<br />
    at Function.Module.runMain (module.js:605:10)<br />
    at startup (bootstrap_node.js:158:16)<br />
    at bootstrap_node.js:575:3</p>
<p>Where is c defined?  Can you help me?<br />
Thanks in advance.</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='/2015/10/working-with-windows-native-code-from-node-js/?replytocom=41261#respond' onclick='return addComment.moveForm( "comment-41261", "41261", "respond", "581" )' aria-label='Reply to Fabrício Lélis'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

	<ul class="children">
	<li class="comment byuser comment-author-steveopendirective-com bypostauthor odd alt depth-2" id="li-comment-41326">
		<div id="comment-41326">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/9cf3b2625e7daf7aa5d01542fbedb2c5?s=40&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9cf3b2625e7daf7aa5d01542fbedb2c5?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Steve</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
			
			<div class="comment-meta commentmetadata"><a href="/2015/10/working-with-windows-native-code-from-node-js/#comment-41326">
				July 16, 2017 at 10:11 am</a>			</div><!-- .comment-meta .commentmetadata -->

			<div class="comment-body"><p>Thanks for reporting that type-o I&#8217;ll fix it.</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='/2015/10/working-with-windows-native-code-from-node-js/?replytocom=41326#respond' onclick='return addComment.moveForm( "comment-41326", "41326", "respond", "581" )' aria-label='Reply to Steve'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			</ol>


	

	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2015/10/working-with-windows-native-code-from-node-js/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='581' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="08c8a0c0ba" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="41"/></p>			</form>
			</div><!-- #respond -->
	
</div><!-- #comments -->


			</div><!-- #content -->
		</div><!-- #container -->

<h2 class="screen-reader-text">More informations</h2>
		<div id="primary" class="widget-area" role="complementary">
			<ul class="xoxo">

<li id="search-2" class="widget-container widget_search"><form role="search" method="get" id="searchform" class="searchform" action="/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
											<li>
					<a href="/2017/03/at-last-true-grids-in-web-browsers/">At last — true grids in web browsers</a>
									</li>
											<li>
					<a href="/2016/10/exploring-reactive-streams-with-serverless-xstream-cyclejs-and-azure-functions/">Using reactive streams on serverless with cyclejs, xstream and Azure Functions</a>
									</li>
											<li>
					<a href="/2016/09/is-the-web-getting-less-webby/">Is the web getting less webby and will serverless make it worse?</a>
									</li>
											<li>
					<a href="/2016/05/aws-azure-or-firebase-for-a-spa-browser-app/">AWS, Azure or Firebase for a SPA browser app? Nope, it&#8217;s Kinvey</a>
									</li>
											<li>
					<a href="/2016/05/i-dont-care-about-the-os-just-give-me-my-web-apps/">&#8220;I don&#8217;t care about the OS, just give me my web Apps&#8221;</a>
									</li>
					</ul>
		</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3><form action="" method="get"><label class="screen-reader-text" for="cat">Categories</label><select  name='cat' id='cat' class='postform' >
	<option value='-1'>Select Category</option>
	<option class="level-0" value="5">a11y&nbsp;&nbsp;(12)</option>
	<option class="level-0" value="32">age&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="16">Android&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="23">Apps&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="27">Assistve Technology&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="31">Audio&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="19">bass&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="20">dementia&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="28">development&nbsp;&nbsp;(12)</option>
	<option class="level-0" value="53">devops&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="21">HTML&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="38">mobile&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="25">mobile a11y&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="18">music&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="3">opena11y&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="4">opensource&nbsp;&nbsp;(11)</option>
	<option class="level-0" value="30">OS X&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="6">personal&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="34">PHP&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="55">serverless&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="29">ss12eu&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="1">Uncategorized&nbsp;&nbsp;(15)</option>
	<option class="level-0" value="17">Video&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="9">web&nbsp;&nbsp;(10)</option>
	<option class="level-0" value="26">web a11y&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="54">web apps&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="22">Win8&nbsp;&nbsp;(4)</option>
	<option class="level-0" value="35">Windows&nbsp;&nbsp;(8)</option>
	<option class="level-0" value="33">WordPress&nbsp;&nbsp;(1)</option>
</select>
</form>
<script type='text/javascript'>
/* <![CDATA[ */
(function() {
	var dropdown = document.getElementById( "cat" );
	function onCatChange() {
		if ( dropdown.options[ dropdown.selectedIndex ].value > 0 ) {
			dropdown.parentNode.submit();
		}
	}
	dropdown.onchange = onCatChange;
})();
/* ]]> */
</script>

</li><li id="linkcat-2" class="widget-container widget_links"><h3 class="widget-title">CMS Accessibility Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://accessible.sprungmarker.de/" title="Home for Sylvia Egger&#8217;s Twenty Ten child theme and other musings">Accessibile Twitter</a></li>
<li><a href="http://groups.drupal.org/accessibility">Drupal Accessibility group</a></li>
<li><a href="http://make.wordpress.org/accessibility/" title="What it says on the tin &#8211; improving WP a11y">WordPress accessibility</a></li>

	</ul>
</li>
<li id="linkcat-24" class="widget-container widget_links"><h3 class="widget-title">Web Accessibility Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://www.456bereastreet.com/" title="Roger Johansson is one of the most active and knowledgeable accessibility bloggers.">456 Berea Street</a></li>
<li><a href="https://medium.com/@dennisl/" title="Dennis E. Lembree&#8217;s blog (the man behind EasyChirp and @webaxe)">Dennis Lembrée</a></li>
<li><a href="http://www.iheni.com/" title="Mobile and web accessibility goodness">Henny Swan</a></li>
<li><a href="http://juicystudio.com/" title="Gez Lemon provides some of the most influential research and writing in the accessibility field, particularly on the technical aspects of accessibility and assistive technologies">Juicy Studio</a></li>
<li><a href="http://blog.paciellogroup.com/" title="Blog from the leading supplier of commercial accessibility services and posts by the mighty Steve Faulkner">The Paciello Group</a></li>
<li><a href="http://webaim.org/blog/" title="Jarrad and the crew at webAIM produce some of the best introductory and advanced articles on web accessibility">WebAIM</a></li>
<li><a href="http://www.webaxe.org/" title="The Blog and podcast on Web Accessibility">WebAxe</a></li>

	</ul>
</li>
<li id="meta-2" class="widget-container widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="/wp-login.php">Log in</a></li>
			<li><a href="/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</li>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">

<h2 class="screen-reader-text">More informations</h2>

			<div id="site-info">
				<a href="/" title="Opening Accessibility" rel="home">
					Opening Accessibility				</a>
			</div><!-- #site-info -->

			<div id="site-generator">
				<a href="#wrapper" class="skip-bottom screen-reader-text">Skip to top</a>				<a href="https://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress.</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->

<script type='text/javascript' src='/wp-includes/js/comment-reply.min.js?ver=4.9.8'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.9.8'></script>
<script async="async" type='text/javascript' src='/wp-content/plugins/akismet/_inc/form.js?ver=4.0.8'></script>
</body>
</html>
